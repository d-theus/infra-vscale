#!/usr/bin/env ruby

$LOAD_PATH << File.expand_path('../..', __FILE__)
$LOAD_PATH << File.expand_path('../../lib', __FILE__)

require 'infra'
require 'colorize'

state_file = ARGV.fetch(0) { fail "State file required" }
state = Infra::State.load(state_file)
Infra::Plan.call(state).each do |cmd|
  color =
    case cmd.type
    when /create/
      :green
    when /modify/
      :yellow
    when /delete/
      :red
    end
  puts cmd.type
  puts cmd.invoke.inspect
  puts "Done!"
end
